<!DOCTYPE html><html lang="ru">
<head>
<meta charset="UTF-8"><title>–ö–æ–ª–æ–¥–∞</title>
<link rel="stylesheet" href="style.css"></head><body>
<a href="/" class="btn">‚Üê –ù–∞–∑–∞–¥</a>
<h1 id="deck-name"></h1>

<h2>–ö–∞—Ä—Ç–æ—á–∫–∏</h2>
<div id="card-list"></div>

<h2>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</h2>
<input id="q" placeholder="–í–æ–ø—Ä–æ—Å"><br>
<input id="a" placeholder="–û—Ç–≤–µ—Ç"><br>
<button onclick="addCard()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>

<br><br>
<div id="learn-buttons"></div>

<script>
  const params  = new URLSearchParams(location.search);
  const deckId  = params.get('id');          // id –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–æ–ª–æ–¥—ã
  if (!deckId) location = '/';

  document.getElementById('learn-buttons').innerHTML = `
    <a class="btn" href="review.html?deckId=${deckId}">–£—á–∏—Ç—å –ø–æ –ø–æ—Ä—è–¥–∫—É</a>
    <a class="btn" href="review.html?deckId=${deckId}&mode=smart">–£—á–∏—Ç—å –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É</a>
  `;


function loadDeck(){ fetch(`/decks/${deckId}`).then(r=>r.json())
  .then(d=>{document.getElementById('deck-name').textContent=d.name}); }

function render(cards){
  const list = document.getElementById('card-list');
  list.innerHTML = '';
  cards.forEach(c => {
    list.insertAdjacentHTML('beforeend', `
      <div class="card" data-id="${c.id}">
        <b>–í:</b> ${c.question}<br>
        <b>–û:</b> ${c.answer}<br>
        <button class="btn-delete" onclick="deleteCard(${c.id})">üóë –£–¥–∞–ª–∏—Ç—å</button>
      </div>
    `);
  });
}

function deleteCard(id) {
  if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É?")) return;
  fetch(`/cards/${id}`, { method: 'DELETE' })
    .then(() => loadCards());
}


function loadCards(){ fetch(`/cards/deck/${deckId}`).then(r=>r.json()).then(render); }
function addCard(){
  const q=document.getElementById('q').value.trim();
  const a=document.getElementById('a').value.trim();
  if(!q||!a) return;
  fetch('/cards',{method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({deckId:Number(deckId),question:q,answer:a})})
    .then(()=>{document.getElementById('q').value='';document.getElementById('a').value='';loadCards();});
}

loadDeck(); loadCards();
</script>
</body></html>
